/* UPDATE 7.1.0.2*/

SET SEARCH_PATH = "COMMON";

UPDATE "Variable" SET "VALUE" = '7.1.0.2' WHERE "NAME" = 'COMMON_DB_VERSION';

SET SEARCH_PATH = "0001";

ALTER TABLE "CMMonitor" ADD COLUMN "ERROR_COUNT" bigint DEFAULT 0;
ALTER TABLE "CMMonitor" ADD COLUMN "WARNING_COUNT" bigint DEFAULT 0;
ALTER TABLE "CMMonitor" ADD COLUMN "NOTIFY" boolean DEFAULT TRUE;

DROP TABLE IF EXISTS "CMMonitorLine" CASCADE;
CREATE TABLE "CMMonitorLine"
(
  "OID" bigserial,
  "OID_MONITOR" bigint,
  "DATE" timestamp without time zone,
  "COMPONENT_IP" character varying(255),
  "COMPONENT_INTERVAL" bigint,
  "COMPONENT_STATUS" bigint DEFAULT 0,
  "STATUS" bigint DEFAULT 0,
  "ERROR_LEVEL" bigint DEFAULT 0,
  "DESCRIPTION" text,  
  CONSTRAINT "PK_CMMonitorLine" PRIMARY KEY ("OID")
)WITHOUT OIDS;

ALTER TABLE "CMMonitorLine" OWNER TO moladmin;
GRANT ALL ON TABLE "CMMonitorLine" TO GROUP "MOLEQULE_ADMINISTRATOR";

ALTER TABLE ONLY "CMMonitorLine"
    ADD CONSTRAINT "FK_CMMonitorLine_CMMonitor" FOREIGN KEY ("OID_MONITOR") REFERENCES "CMMonitor"("OID") ON UPDATE CASCADE ON DELETE CASCADE;